# Бэкенд для News Explorer

Бэкенд доступен по ссылкам:

[http://www.api.news-explorer-project.ml/](http://www.api.news-explorer-project.ml/)

[http://api.news-explorer-project.ml/](http://api.news-explorer-project.ml)

## Публичный IPv4

130.193.37.144

## Установка

Склонируйте проект

```bash
git clone https://github.com/varyalikhanina/news-explorer-api.git
```
Установите зависимости

```bash
npm install
```

Запустите проект (по умолчанию на локальном сервере 3000)
```bash
npm start
```

Для разработки используйте
```bash
npm dev
```

## Подробнее

Node.js приложение подключается к серверу Mongo по адресу mongodb://localhost:27017/news-explorer;

созданы схема и модель пользователя с полями name, email и password, поля корректно валидируются;

созданы схема и модель статьи с полями title, text, date, source, keyword, link и image, поля корректно валидируются;

реализованы следующие контроллеры и роуты:
- GET /users/me возвращает информацию о пользователе (email и имя);
- GET /articles возвращает все сохранённые пользователем статьи;
- POST /articles создаёт статью с переданными в теле keyword, title, text, date, source, link и image;
- DELETE /articles/articleId удаляет сохранённую статью по _id;

если клиент не прислал JWT, доступ к роутам закрыт;

если в любом из запросов что-то идёт не так, сервер возвращает ответ с ошибкой и соответствующим ей статусом.

в контроллере createUser почта и хеш пароля записываются в базу;

есть контроллер login, он проверяет, полученные в теле запроса почту и пароль. Если почта и пароль верные, контроллер login создаёт JWT, в пейлоуд которого записано свойство _id с идентификатором пользователя, срок жизни токена — 7 дней. Если почта и пароль верные, контроллер login возвращает созданный токен в ответе. Если почта и пароль не верные, контроллер login возвращает ошибку 401;

в app.js есть обработчики POST-запросов на роуты /signin и /signup;

есть файл middlewares/auth.js, в нём мидлвэр для проверки JWT. При правильном JWT авторизационный мидлвэр добавляет в объект запроса пейлоуд и пропускает запрос дальше, при неправильном JWT авторизационный мидвэр возвращает ошибку 401;

все роуты, кроме /signin и /signup, защищены авторизацией;

пользователь не может удалить статью, которую он не сохранял;

API не возвращает хеш пароля;

все ошибки обрабатываются централизованно;

тела запросов и, где необходимо, заголовки и параметры, валидируются по определённым схемам. Если запрос не соответствует схеме, обработка не передаётся контроллеру и клиент получает ошибку валидации;

все запросы и ответы записываются в файл request.log, все ошибки записываются в файл error.log. файлы логов не добавляются в репозиторий;

к серверу можно обратиться по публичному IP-адресу;

к серверу можно обратиться по http и по https, используя домен;

секретный ключ для создания и верификации JWT хранится на сервере в .env файле;

в режиме разработки (когда process.env.NODE_ENV !== 'production') код запускается и работает без наличия .env файла;

сервер самостоятельно восстанавливается после GET-запроса на URL /crash-test.
